@{
}
<div class="container-fluid" style="height: 100vh;">
    <div class=" block justify-between items-center p-4  mt-4 mb-6 bg-white rounded-2xl shadow-xl shadow-gray-200 lg:p-5 sm:flex">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <i class="ph-bold ph-house" style="font-size: 20px; margin: auto 5px;"></i>
                <li class="breadcrumb-item"> <a>Trang chủ</a></li>
                <li class="breadcrumb-item active" aria-current="page"> Cá nhân</li>
            </ol>
        </nav>
        <h1 class="typeHead">THAY ĐỔI MẬT KHẨU</h1>
    </div>
    <div class="changPassForm">
        <h4 class="td">THAY ĐỔI MẬT KHẨU</h4>
        <form class="row g-3">
            <div class="col-md-12">
                <label for="inputCCCD" class="form-label" >Nhật mật khẩu cũ</label>
                <input type="password" class="form-input" >
                <span class="text-danger"></span>
            </div>
            <div class="col-md-12">
                <label for="inputPhone" class="form-label">Nhập mật khẩu mới</label>
                <input type="password" class="form-input" >
                <span class="text-danger" ></span>
            </div>
            <div class="col-md-12">
                <label for="inputEmail4" class="form-label" >Xác nhận mật khẩu mới</label>
                <input type="password" class="form-input">
                <span class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <button class="btn-addRole" style="width: 100%;" onclick="changePassAction()">
                    THAY ĐỔI MẬT KHẨU
                </button>
            </div>
        </form>
        <hr />
        <div class="getOTP">
            <h4 class="td">NHẬP MÃ OTP</h4>
            <div class="otp-container">
                <input class="otp-input" type="text" maxlength="1" oninput="handleInput(this, 2)" id="inputOtp1">
                <input class="otp-input" type="text" maxlength="1" oninput="handleInput(this, 3)" id="inputOtp2">
                <input class="otp-input" type="text" maxlength="1" oninput="handleInput(this, 4)" id="inputOtp3">
                <input class="otp-input" type="text" maxlength="1" oninput="handleInput(this, 5)" id="inputOtp4">
                <input class="otp-input" type="text" maxlength="1" oninput="handleInput(this, 6)" id="inputOtp5">
                <input class="otp-input" type="text" maxlength="1" oninput="handleInput(this, 7)" id="inputOtp6">
            </div>
            <script>
                function handleInput(input, nextInputIndex) {
                    const maxLength = parseInt(input.getAttribute('maxlength'), 10);
                    const inputValue = input.value;

                    if (inputValue.length === maxLength) {
                        const nextInput = document.querySelector(`.otp-input:nth-child(${nextInputIndex})`);

                        if (nextInput) {
                            nextInput.focus();
                        }
                    } else if (inputValue.length === 0) {
                        const previousInputIndex = nextInputIndex - 2; // 1-based index to 0-based index
                        const previousInput = document.querySelector(`.otp-input:nth-child(${previousInputIndex})`);

                        if (previousInput) {
                            previousInput.focus();
                        }
                    }
                }
            </script>
            <div class="row justify-content-around">
                <button class="btn-addRole" type="submit" id="myButton" onclick="handleClick(event)">
                    Lấy mã OTP
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    let isButtonDisabled = false;

    function handleClick(event) {
        $.ajax({
            url: '@Url.Action("GetOTP")',
            type: 'GET',
            contentType: 'application/json',
            success: function (result) {
                if (!result.success) {
                    const button = document.getElementById('myButton');
                    if (!isButtonDisabled) {
                        const countdownSpan = document.createElement('span');
                        countdownSpan.className = 'countdown';
                        button.appendChild(countdownSpan);

                        disableButtonForSeconds(180, countdownSpan);
                        button.style.cursor = 'not-allowed';
                    }
                    event.preventDefault();
                }
            },
            error: function () {
                console.error('Lỗi khi gửi yêu cầu.');
            }
        });
    }

    function disableButtonForSeconds(seconds, countdownSpan) {
        isButtonDisabled = true;
        document.getElementById('myButton').classList.add('disabled');

        let secondsRemaining = seconds;

        const countdownInterval = setInterval(() => {
            const minutes = Math.floor(secondsRemaining / 60);
            const remainingSeconds = secondsRemaining % 60;

            if (secondsRemaining <= 0) {
                clearInterval(countdownInterval);
                isButtonDisabled = false;
                document.getElementById('myButton').classList.remove('disabled');
                document.getElementById('myButton').style.cursor = 'pointer';
                countdownSpan.remove();
            } else {
                countdownSpan.textContent = ` (${minutes}p ${remainingSeconds}s)`;
                secondsRemaining--;
            }
        }, 1000);
    }

    function changePassAction() {

        var otp = $('#inputOtp1').val() + $('#inputOtp2').val() + $('#inputOtp3').val() + $('#inputOtp4').val() + $('#inputOtp5').val() + $('#inputOtp6').val();

        var changePassword = {
            Password: $('#passOld').val(),
            NewPassword: $('#passNew').val(),
            ConfirmNewPassword $('#ConfirmPassNew').val(),
            EmployeeID: '',
            ComfirmOTP: otp
        };

        $.ajax({
            url: '@Url.Action("ChangePassAction")',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(changePassword),
            success: function (result) {
                if (!result.success) {
                    // Chuyển hướng tới trang mong muốn
                    var redirectToUrl = '@Url.Action("Index", "Director")';
                    window.location.href = redirectToUrl;
                }
            },
            error: function () {
                console.error('Lỗi khi gửi yêu cầu.');
            }
        });
    }

</script>